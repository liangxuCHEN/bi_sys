{% extends "base.html" %}
{% block head %}
<script src="/static/js/echarts.js" charset="utf-8"></script>

{% endblock %}

{% block title %}Order{% endblock %}


{% block content %}
<div class="container-fluid">
	<div class="row">
	    <div class="col-md-8">
	        <!-- 为 ECharts 准备一个具备大小（宽高）的 DOM -->
	        <div id="main" style="height:400px;"></div>
	    </div>
<!-- 	    <div class="col-md-5">
	        为 ECharts 准备一个具备大小（宽高）的 DOM
	        <div id="bar" style="height:400px;"></div>
	    </div> -->
	</div>
	<div class="row">
		<div class="col-md-8">
			<div id="pie" style="height:600px;"></div>
		</div>
	</div>
</div>
{% endblock %}


{% block script %}

<script type="text/javascript">

        // 基于准备好的dom，初始化echarts实例
        var myChart = echarts.init(document.getElementById('main'));

        // 指定图表的配置项和数据
        myChart.setOption({
            backgroundColor: '#2c343c',
            textStyle: {
                color: 'rgba(255, 255, 255, 0.3)',
            },
            title: {
                textStyle: {
                    color: 'rgba(255, 255, 255, 0.3)'
                },
                text: '客户订单'
            },
            tooltip : {
                trigger: 'axis'
            },
            toolbox: {
                show : true,
                feature : {
                    mark : {show: true},
                    dataView : {show: true, readOnly: false},
                    saveAsImage : {show: true},
                    dataZoom: {show: true},
                    restore: {show: true},
                    magicType: {
                    	show:true,
                    	type: ['bar', 'line'],
                    },
                }
            },
            calculable : true,
            legend: {
                textStyle: {
                    color: 'rgba(255, 255, 255, 0.3)'
                },
                data:['总额']
            },
            xAxis: {
                data: []
            },
            yAxis: {},
            series: [{
                name: '总额',
                type: 'bar',
                data: [],
                markLine : {
                    data : [
                        {type : 'average', name : '平均值'}
                    ]
                },
                markPoint : {
                    data : [
                        {type : 'max', name: '最大值'},
                        {type : 'min', name: '最小值'}
                    ]
                },
                }

            ]
        })

       
        var myChart2 = echarts.init(document.getElementById('pie'));
        myChart2.setOption({
        	backgroundColor: '#2c343c',
            textStyle: {
                color: 'rgba(255, 255, 255, 0.3)',
            },
            title : {
            	textStyle: {
                    color: 'rgba(255, 255, 255, 0.3)'
                },
                text: '订单数量',
                x:'center'
            },
            tooltip : {
                trigger: 'item',
                formatter: "{a} <br/>{b} : {c} ({d}%)"
            },
            legend: {
            	textStyle: {
                    color: 'rgba(255, 255, 255, 0.3)'
                },
                orient: 'vertical',
                right: 10,
                top: 20,
                bottom: 20,
                data: []
            },
            series : [
                {
                    name: '客户订单',
                    type: 'pie',
                    selectedMode: 'single',
                    radius: [0, '30%'],
                    data: [],
                    label: {
                        normal: {
                           position: 'inner'
                        }
                    },
                    labelLine: {
                    	normal: {
                    	    show: false
                    	}
                    },
                    itemStyle: {
                        emphasis: {
                            shadowBlur: 5,
                            shadowOffsetX: 0,
                            shadowColor: 'rgba(0, 0, 0, 0.5)'
                        }
                    }
                },
                {
                    name:'订单状态',
                    type:'pie',
                    radius: ['40%', '55%'],
                    label: {
                        normal: {
                            formatter: '{a|{a}}{abg|}\n{hr|}\n  {b|{b}：}{c}  {per|{d}%}  ',
                            backgroundColor: '#2c343c',
                            borderColor: '#aaa',
                            borderWidth: 1,
                            borderRadius: 4,
                            rich: {
                                a: {
                                    color: '#999',
                                    lineHeight: 22,
                                    align: 'center'
                                },
                                hr: {
                                    borderColor: '#aaa',
                                    width: '100%',
                                    borderWidth: 0.5,
                                    height: 0
                                },
                                b: {
                                    fontSize: 16,
                                    lineHeight: 33
                                },
                                per: {
                                    color: '#eee',
                                    backgroundColor: '#334455',
                                    padding: [2, 4],
                                    borderRadius: 2
                                }
                            }
                        }
                    },
                    data:[]
                }
            ]
        });

         $.get('api_show_data').done(function (response) {
        	var data = response.data
        	//console.log(data)
            // 填入数据
            myChart.setOption({
            	title: {
            	    subtext: '总金额：' + data.total,
            	},
                xAxis: {
                    data: data.companys
                },
                series: [{
                    // 根据名字对应到相应的系列
                    name: '总额',
                    data: data.total_price
                }]
            });

            // 填入数据
            myChart2.setOption({
            	title: {
            	    subtext: '总订单量：' + data.total_order,
            	},
                legend: {
                    data: data.companys
                },
                series: [
                  {
                    // 根据名字对应到相应的系列
                    name: '客户订单',
                    data: data.orders_by_companys
                  },
                  {
                    // 根据名字对应到相应的系列
                    name: '订单状态',
                    data: data.orders_by_states
                  },

                ]
            });

        });


        setTimeout(function (){
            window.onresize = function () {
                myChart.resize();
                myChart2.resize();
            }
        },200)

    </script>
{% endblock %}